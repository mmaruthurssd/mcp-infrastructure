import execa from 'execa';
import which from 'which';
import { existsSync } from 'fs';
const convertStringToObject = (sourceLine) => {
    const matches = sourceLine.match(/(.+)\s+\((.+)\s+(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2} (\+|\-)\d{4})\s+(\d+)\)(.*)/);
    const [, rev, author, date, , line] = matches
        ? [...matches]
        : [null, '', '', '', '', ''];
    return {
        author,
        date,
        line,
        rev
    };
};
export async function git(path) {
    const blamedLines = {};
    const pathToGit = await which('git');
    if (!existsSync(path)) {
        throw new Error(`File ${path} does not exist`);
    }
    const result = await execa(pathToGit, ['blame', '-w', path]);
    result.stdout.split('\n').forEach(line => {
        if (line !== '') {
            const blamedLine = convertStringToObject(line);
            if (blamedLine.line) {
                blamedLines[blamedLine.line] = blamedLine;
            }
        }
    });
    return {
        [path]: blamedLines
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2l0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Zjcy9naXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE1BQU0sT0FBTyxDQUFDO0FBQzFCLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUxQixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBRWhDLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxVQUFrQixFQUFjLEVBQUU7SUFDL0QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FDOUIsa0ZBQWtGLENBQ25GLENBQUM7SUFDRixNQUFNLENBQUMsRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxBQUFELEVBQUcsSUFBSSxDQUFDLEdBQUcsT0FBTztRQUMzQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDL0IsT0FBTztRQUNMLE1BQU07UUFDTixJQUFJO1FBQ0osSUFBSTtRQUNKLEdBQUc7S0FDSixDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLEtBQUssVUFBVSxHQUFHLENBQUMsSUFBWTtJQUNwQyxNQUFNLFdBQVcsR0FBbUMsRUFBRSxDQUFDO0lBQ3ZELE1BQU0sU0FBUyxHQUFXLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRTdDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDckIsTUFBTSxJQUFJLEtBQUssQ0FBQyxRQUFRLElBQUksaUJBQWlCLENBQUMsQ0FBQztLQUNoRDtJQUNELE1BQU0sTUFBTSxHQUFHLE1BQU0sS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM3RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdkMsSUFBSSxJQUFJLEtBQUssRUFBRSxFQUFFO1lBQ2YsTUFBTSxVQUFVLEdBQUcscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDL0MsSUFBSSxVQUFVLENBQUMsSUFBSSxFQUFFO2dCQUNuQixXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQzthQUMzQztTQUNGO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPO1FBQ0wsQ0FBQyxJQUFJLENBQUMsRUFBRSxXQUFXO0tBQ3BCLENBQUM7QUFDSixDQUFDIn0=