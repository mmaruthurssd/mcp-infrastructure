# Project Planning Workflow Definition
# Defines phases, steps, and workflow configuration for project planning orchestration

workflow:
  name: project-planning
  version: "1.0"
  description: "Standard project planning workflow with initialization, goal development, execution, and completion phases"

# Phase definitions
phases:
  initialization:
    name: "Initialization"
    description: "Set up project structure, constitution, and foundational documents"
    order: 1
    steps:
      - id: create-structure
        name: "Create Structure"
        description: "Initialize project folder structure"
        required: true
      - id: generate-constitution
        name: "Generate Constitution"
        description: "Create project constitution with principles and guidelines"
        required: true
      - id: identify-stakeholders
        name: "Identify Stakeholders"
        description: "Document project stakeholders and their roles"
        required: true
      - id: identify-resources
        name: "Identify Resources"
        description: "Catalog available resources and tools"
        required: true
      - id: generate-roadmap
        name: "Generate Roadmap"
        description: "Create initial project roadmap with phases and milestones"
        required: true

    # Prerequisites to exit this phase
    exit_conditions:
      - constitution_exists: true
      - stakeholders_documented: true
      - all_steps_complete: true

  goal-development:
    name: "Goal Development"
    description: "Brainstorm, evaluate, and select project goals"
    order: 2
    steps:
      - id: brainstorm-ideas
        name: "Brainstorm Ideas"
        description: "Capture ideas in brainstorming discussion"
        required: false
      - id: evaluate-goals
        name: "Evaluate Goals"
        description: "Assess potential goals for impact and effort"
        required: true
      - id: create-potential-goals
        name: "Create Potential Goals"
        description: "Document evaluated goals as potential goals"
        required: true
      - id: promote-to-selected
        name: "Promote to Selected"
        description: "Move high-priority potential goals to selected status"
        required: true

    exit_conditions:
      - at_least_one_selected_goal: true
      - all_required_steps_complete: true

  execution:
    name: "Execution"
    description: "Implement selected goals through specifications and task workflows"
    order: 3
    steps:
      - id: create-specification
        name: "Create Specification"
        description: "Generate detailed specification for selected goal"
        required: true
      - id: create-tasks
        name: "Create Tasks"
        description: "Break down specification into actionable tasks"
        required: true
      - id: execute-workflow
        name: "Execute Workflow"
        description: "Complete tasks and track progress"
        required: true
      - id: update-progress
        name: "Update Progress"
        description: "Maintain goal progress based on task completion"
        required: true

    exit_conditions:
      - all_selected_goals_complete: true
      - no_active_workflows: true

  completion:
    name: "Completion"
    description: "Validate deliverables, document outcomes, and finalize project"
    order: 4
    steps:
      - id: validate-deliverables
        name: "Validate Deliverables"
        description: "Ensure all goals and deliverables are complete"
        required: true
      - id: complete-documentation
        name: "Complete Documentation"
        description: "Finalize all project documentation"
        required: true
      - id: archive-goals
        name: "Archive Goals"
        description: "Move completed goals to archive with retrospectives"
        required: true
      - id: wrap-up-project
        name: "Wrap Up Project"
        description: "Generate completion report and close project"
        required: true

    exit_conditions:
      - all_goals_archived: true
      - completion_report_generated: true

# Workflow-specific state fields (stored in customData)
state_schema:
  goals:
    type: object
    properties:
      potential:
        type: array
        description: "List of potential goal folder names"
      selected:
        type: array
        description: "List of selected goal folder names"
      completed:
        type: array
        description: "List of completed goal folder names"

  integrations:
    type: object
    properties:
      specDriven:
        type: object
        description: "Spec-Driven MCP integration tracking"
        properties:
          used:
            type: boolean
          lastHandoff:
            type: string
            nullable: true
          goalsWithSpecs:
            type: array
      taskExecutor:
        type: object
        description: "Task Executor MCP integration tracking"
        properties:
          activeWorkflows:
            type: array
          lastCreated:
            type: string
            nullable: true
          totalWorkflowsCreated:
            type: number

# File path mappings for auto-sync
file_paths:
  potential_goals: "brainstorming/future-goals/potential-goals"
  selected_goals: "02-goals-and-roadmap/selected-goals"
  archived_goals: "brainstorming/future-goals/archived-goals"
  active_workflows: "temp/workflows"
  archived_workflows: "archive/workflows"
  constitution: "brainstorming/future-goals/CONSTITUTION.md"
  stakeholders: "03-resources-docs-assets-tools/STAKEHOLDERS.md"
  roadmap: "02-goals-and-roadmap/ROADMAP.md"

# Rule configuration references
rules:
  source: "./project-planning-rules.ts"
  count: 10
  priority_range: [60, 95]

# Integration configurations
integrations:
  spec_driven_mcp:
    enabled: true
    handoff_tool: "prepare_spec_handoff"
    tracks_state: true

  task_executor_mcp:
    enabled: true
    handoff_tool: "prepare_task_executor_handoff"
    tracks_state: true

# Validation rules
validation:
  phase_transition:
    require_all_steps_complete: true
    allow_skip: false

  goal_promotion:
    require_evaluation: true
    require_impact_assessment: true
    require_effort_assessment: true

# Metadata
metadata:
  created: "2025-10-29"
  author: "Workflow Orchestrator Extraction Project"
  extracted_from: "Project Management MCP Server v0.9.0"
  supports_generic_workflows: false
  notes: |
    This workflow definition documents the project-planning workflow structure.
    Future enhancement: Use this YAML to drive workflow behavior instead of hardcoded logic.
