{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "name": "workspace-index-mcp-server",
  "version": "2.0.0",
  "templateVersion": "1.0.0",
  "description": "Workspace indexing + documentation validation + autonomous documentation management with confidence-based autonomy",
  "category": "intelligence",
  "maturity": "production",

  "capabilities": {
    "phase1": "Project indexing and searchable file cataloging",
    "phase2": "Documentation consistency validation (counts, status, inventory)",
    "phase3": "Drift detection and auto-correction",
    "phase4": "Autonomous documentation lifecycle management (supersession, consolidation, archival)"
  },

  "installation": {
    "type": "dual-environment",
    "staging_path_template": "development/mcp-servers/workspace-index-mcp-server-project/04-product-under-development/staging/",
    "production_path_template": "local-instances/mcp-servers/workspace-index-mcp-server/",
    "requires_customization": true,
    "customization_method": "auto-detect",

    "steps": [
      {
        "step": 1,
        "action": "detect_workspace_structure",
        "description": "Scan workspace to auto-detect structure patterns and customize configuration",
        "ai_instructions": [
          "Use glob patterns to identify workspace structure:",
          "  - Development directories: Check for 'development/', 'dev/', 'staging/', 'projects-in-development/'",
          "  - Production directories: Check for 'local-instances/', 'production/', 'deployed/', 'live/'",
          "  - Archive locations: Check for 'archive/', 'archived/', 'historical/'",
          "  - Framework locations: Check for 'development/frameworks/', 'frameworks/', 'patterns/'",
          "  - Template directories: Check for 'templates-and-patterns/', 'templates/', 'patterns/'",
          "  - Documentation roots: Scan for README.md, WORKSPACE_GUIDE.md, WORKSPACE_ARCHITECTURE.md",
          "",
          "Populate workspace-index-config.json by replacing {{AUTO_DETECT:...}} placeholders with detected paths.",
          "If multiple matches found, prefer the first match in the priority order shown above.",
          "",
          "Determine workspace maturity:",
          "  - 'new': No existing workspace-brain-mcp or learned patterns",
          "  - 'mature': Has workspace-brain-mcp and/or archive/learned-patterns/",
          "",
          "Set confidence thresholds based on maturity:",
          "  - New workspaces: auto_execute_threshold = 0.95 (conservative)",
          "  - Mature workspaces: auto_execute_threshold = 0.85 (learned)",
          "",
          "Identify critical documentation files that should never be auto-archived:",
          "  - Always include: README.md, WORKSPACE_GUIDE.md, SECURITY_BEST_PRACTICES.md",
          "  - Scan for other critical docs (ARCHITECTURE.md, CONTRIBUTING.md, etc.)"
        ],
        "outputs": [
          "workspace-index-config.json (customized for this workspace)"
        ],
        "validation": [
          "Verify all detected paths exist",
          "Verify at least one documentation root found",
          "Verify development and production directories detected or fallback used"
        ]
      },
      {
        "step": 2,
        "action": "setup_staging_environment",
        "description": "Create staging directory and copy template source",
        "ai_instructions": [
          "Create staging directory structure:",
          "  mkdir -p {{detected.development_dir}}/mcp-servers/workspace-index-mcp-server-project/04-product-under-development/staging/",
          "",
          "Copy template source to staging:",
          "  cp -r <template-source>/* {{staging_path}}/",
          "",
          "Copy customized config to staging:",
          "  cp workspace-index-config.json {{staging_path}}/",
          "",
          "Verify all files copied successfully"
        ],
        "commands": [
          "mkdir -p {{staging_path}}",
          "cp -r {{template_source}}/* {{staging_path}}/",
          "cp workspace-index-config.json {{staging_path}}/"
        ],
        "validation": [
          "Verify package.json exists in staging",
          "Verify src/ directory exists",
          "Verify workspace-index-config.json exists"
        ]
      },
      {
        "step": 3,
        "action": "build_staging",
        "description": "Install dependencies and build MCP in staging environment",
        "ai_instructions": [
          "Navigate to staging directory",
          "Install dependencies: npm install",
          "Build TypeScript: npm run build",
          "Verify dist/ directory created",
          "Run tests: npm test",
          "Verify all tests pass"
        ],
        "commands": [
          "cd {{staging_path}}",
          "npm install",
          "npm run build",
          "npm test"
        ],
        "expected_artifacts": [
          "{{staging_path}}/dist/index.js",
          "{{staging_path}}/dist/tools/",
          "{{staging_path}}/dist/adapters/",
          "{{staging_path}}/dist/config/",
          "{{staging_path}}/node_modules/"
        ],
        "validation": [
          "Build exits with code 0",
          "All tests pass",
          "dist/index.js exists and is executable"
        ]
      },
      {
        "step": 4,
        "action": "deploy_production",
        "description": "Deploy built artifacts to production (local-instances/)",
        "ai_instructions": [
          "Create production directory if doesn't exist:",
          "  mkdir -p {{detected.production_dir}}/mcp-servers/workspace-index-mcp-server/",
          "",
          "Copy built artifacts from staging to production:",
          "  cp -r {{staging_path}}/dist/* {{production_path}}/",
          "  cp {{staging_path}}/package.json {{production_path}}/",
          "  cp {{staging_path}}/workspace-index-config.json {{production_path}}/",
          "  cp {{staging_path}}/node_modules/ {{production_path}}/ (optional - can run npm install in production)",
          "",
          "Verify deployment:",
          "  ls {{production_path}}/index.js",
          "  ls {{production_path}}/workspace-index-config.json"
        ],
        "commands": [
          "mkdir -p {{production_path}}",
          "cp -r {{staging_path}}/dist/* {{production_path}}/",
          "cp {{staging_path}}/package.json {{production_path}}/",
          "cp {{staging_path}}/workspace-index-config.json {{production_path}}/",
          "cd {{production_path}} && npm install --production"
        ],
        "validation": [
          "{{production_path}}/index.js exists",
          "{{production_path}}/workspace-index-config.json exists",
          "{{production_path}}/tools/ directory exists"
        ]
      },
      {
        "step": 5,
        "action": "validate_mcp_configuration",
        "description": "MANDATORY: Validate configuration against MCP-CONFIGURATION-CHECKLIST.md",
        "ai_instructions": [
          "**CRITICAL:** Follow MCP-CONFIGURATION-CHECKLIST.md (templates-and-patterns/mcp-server-templates/MCP-CONFIGURATION-CHECKLIST.md) BEFORE registration.",
          "",
          "Pre-Flight Checks (Section 1):",
          "  - Verify Node.js >= 18.0.0",
          "  - Verify npm >= 8.0.0",
          "  - Check disk space > 500MB",
          "  - Test network connectivity",
          "  - Check write permissions",
          "",
          "Duplicate Prevention (Section 4):",
          "  - Run: claude mcp list",
          "  - Verify workspace-index NOT already registered",
          "  - If 'project-index-generator' exists, plan to remove it",
          "  - Verify NO workspace .mcp.json exists (causes conflicts)",
          "",
          "Path Validation (Section 6):",
          "  - Verify all paths are absolute (no relative paths)",
          "  - Verify NO ${workspaceFolder} anywhere (not supported in ~/.claude.json)",
          "  - Verify path points to dist/index.js (compiled output)",
          "  - Test: ls -la {{absolute_production_path}}/index.js",
          "",
          "Security Validation (Section 5):",
          "  - Verify NO workspace .mcp.json created",
          "  - Verify credentials will be in ~/.claude.json only",
          "  - Verify ~/.claude.json never committed to git",
          "  - Document required env vars in README (without actual values)",
          "",
          "Configuration Backup:",
          "  - cp ~/.claude.json ~/.claude.json.backup-$(date +%Y%m%d-%H%M%S)",
          "",
          "If ANY validation fails, STOP and fix before proceeding to registration."
        ],
        "validation": [
          "Node.js >= 18.0.0",
          "npm >= 8.0.0",
          "No duplicate registrations (claude mcp list shows no workspace-index)",
          "No workspace .mcp.json file exists",
          "All paths are absolute",
          "Production dist/index.js exists and is valid JavaScript",
          "Backup of ~/.claude.json created"
        ],
        "references": [
          "templates-and-patterns/mcp-server-templates/MCP-CONFIGURATION-CHECKLIST.md"
        ]
      },
      {
        "step": 6,
        "action": "register_mcp",
        "description": "Register MCP server in Claude Code configuration (follows MCP-CONFIGURATION-CHECKLIST.md)",
        "ai_instructions": [
          "Locate Claude Code config file:",
          "  - macOS: ~/.config/claude-code/config.json",
          "  - Windows: %APPDATA%/claude-code/config.json",
          "  - Linux: ~/.config/claude-code/config.json",
          "",
          "Add MCP entry to mcpServers section:",
          "{",
          "  \"workspace-index\": {",
          "    \"command\": \"node\",",
          "    \"args\": [\"{{absolute_production_path}}/index.js\"],",
          "    \"env\": {",
          "      \"WORKSPACE_ROOT\": \"{{workspace_root}}\",",
          "      \"CONFIG_PATH\": \"{{absolute_production_path}}/workspace-index-config.json\"",
          "    }",
          "  }",
          "}",
          "",
          "If 'project-index-generator' entry exists, remove it (workspace-index replaces it)",
          "",
          "Save config file",
          "Validate JSON syntax"
        ],
        "config_entry": {
          "workspace-index": {
            "command": "node",
            "args": ["{{ABSOLUTE_PRODUCTION_PATH}}/index.js"],
            "env": {
              "WORKSPACE_ROOT": "{{WORKSPACE_ROOT}}",
              "CONFIG_PATH": "{{ABSOLUTE_PRODUCTION_PATH}}/workspace-index-config.json"
            }
          }
        },
        "validation": [
          "Config file has valid JSON syntax",
          "workspace-index entry exists",
          "Paths in config are absolute, not relative"
        ]
      },
      {
        "step": 7,
        "action": "validate_installation",
        "description": "Test MCP is operational and all tools respond correctly",
        "ai_instructions": [
          "Restart Claude Code completely:",
          "  - Quit Claude Code",
          "  - Wait 5 seconds",
          "  - Relaunch Claude Code",
          "",
          "Test Phase 1-3 tools (existing functionality):",
          "  1. generate_project_index() - Should return file catalog",
          "  2. validate_workspace_documentation() - Should validate docs against reality",
          "  3. update_workspace_docs_for_reality() - Should preview or apply corrections",
          "",
          "Test Phase 4 tools (new functionality):",
          "  1. analyze_documentation_health() - Should detect lifecycle issues",
          "     - Run with scope: 'workspace', checks: 'all'",
          "     - Verify returns healthScore, issues array, summary",
          "  2. execute_documentation_operation() - Should preview operation",
          "     - Run with dryRun: true on a detected issue",
          "     - Verify returns preview without executing",
          "",
          "Verify configuration:",
          "  - Check that detected workspace structure matches actual structure",
          "  - Verify confidence thresholds are appropriate for workspace maturity",
          "",
          "If any tool fails:",
          "  - Check logs: tail -f ~/.claude-code/logs/mcp-server-workspace-index.log",
          "  - Verify config path is correct",
          "  - Verify all dependencies installed"
        ],
        "test_commands": [
          "generate_project_index()",
          "validate_workspace_documentation({ checks: ['all'], reportFormat: 'summary' })",
          "analyze_documentation_health({ scope: 'workspace', checks: ['all'], depth: 'quick' })"
        ],
        "success_criteria": [
          "All 5 tools respond without errors",
          "analyze_documentation_health() returns valid health report",
          "execute_documentation_operation() dry-run works",
          "No errors in MCP server logs"
        ]
      },
      {
        "step": 8,
        "action": "optional_enable_automation",
        "description": "Optionally enable automation features (scheduled scans, hooks)",
        "ai_instructions": [
          "Review workspace-index-config.json automation settings:",
          "  - auto_execute_enabled: Controls whether high-confidence operations auto-execute",
          "  - enable_scheduled_scans: Weekly documentation health scans",
          "  - enable_git_hooks: Pre-commit validation warnings",
          "  - enable_post_operation_hooks: Trigger after project wrap-up, MCP deployment",
          "",
          "For new workspaces, recommended to start with automation DISABLED:",
          "  - Let AI observe patterns for 2-4 weeks",
          "  - Build confidence in detection accuracy",
          "  - Then enable automation",
          "",
          "For mature workspaces with learning history:",
          "  - Can enable automation immediately if confidence is high",
          "",
          "To enable automation:",
          "  1. Edit {{production_path}}/workspace-index-config.json",
          "  2. Set desired automation flags to true",
          "  3. Restart Claude Code to apply changes",
          "",
          "Monitor automation:",
          "  - Check workspace-brain logs for documentation operations",
          "  - Review weekly scan reports",
          "  - Adjust confidence thresholds if too many false positives/negatives"
        ],
        "optional": true
      }
    ]
  },

  "auto_configuration": {
    "enabled": true,
    "method": "pattern_detection",

    "workspace_detection_patterns": {
      "development_dir": {
        "patterns": ["development/", "dev/", "staging/", "projects-in-development/"],
        "priority_order": true,
        "fallback": "development/"
      },
      "production_dir": {
        "patterns": ["local-instances/", "production/", "deployed/", "live/"],
        "priority_order": true,
        "fallback": "local-instances/"
      },
      "archive_dir": {
        "patterns": ["archive/", "archived/", "historical/"],
        "priority_order": true,
        "fallback": "archive/"
      },
      "frameworks_dir": {
        "patterns": ["development/frameworks/", "frameworks/", "patterns/", "templates-and-patterns/frameworks/"],
        "priority_order": true,
        "fallback": "frameworks/"
      },
      "templates_dir": {
        "patterns": ["templates-and-patterns/", "templates/", "patterns/"],
        "priority_order": true,
        "fallback": "templates/"
      },
      "documentation_roots": {
        "required_files": ["README.md"],
        "optional_files": ["WORKSPACE_GUIDE.md", "WORKSPACE_ARCHITECTURE.md", "CONTRIBUTING.md", "SECURITY_BEST_PRACTICES.md"],
        "scan_root": true
      }
    },

    "maturity_detection": {
      "indicators": {
        "new": [
          "No workspace-brain-mcp in production",
          "No archive/learned-patterns/ directory",
          "Fewer than 5 MCPs deployed"
        ],
        "mature": [
          "workspace-brain-mcp operational",
          "archive/learned-patterns/ exists with data",
          "10+ MCPs deployed",
          "Autonomous Deployment Framework present"
        ]
      },
      "threshold_mapping": {
        "new": {
          "auto_execute": 0.95,
          "assisted_mode_min": 0.85
        },
        "mature": {
          "auto_execute": 0.85,
          "assisted_mode_min": 0.70
        }
      }
    },

    "critical_docs_detection": {
      "always_critical": [
        "README.md",
        "WORKSPACE_GUIDE.md",
        "SECURITY_BEST_PRACTICES.md",
        "CONTRIBUTING.md"
      ],
      "pattern_based_critical": [
        "**/SECURITY*.md",
        "**/HIPAA*.md",
        "**/COMPLIANCE*.md"
      ]
    }
  },

  "dependencies": {
    "required": {
      "node": ">=18.0.0",
      "npm": ">=9.0.0"
    },
    "npm_packages": {
      "@modelcontextprotocol/sdk": "^0.5.0",
      "glob": "^10.3.10",
      "minimatch": "^9.0.3"
    },
    "required_mcps": [],
    "optional_integrations": [
      {
        "mcp": "workspace-brain-mcp",
        "purpose": "Learning system - log operations and improve confidence scoring",
        "required": false,
        "fallback": "In-memory learning only (resets on restart)"
      },
      {
        "mcp": "project-management-mcp",
        "purpose": "Post-operation hooks - trigger health checks after project wrap-up",
        "required": false,
        "fallback": "Manual triggering only"
      },
      {
        "mcp": "learning-optimizer-mcp",
        "purpose": "Pattern tracking - track documentation issues as learnings",
        "required": false,
        "fallback": "No pattern optimization"
      }
    ]
  },

  "configuration": {
    "config_file": "workspace-index-config.json",
    "customization_required": true,
    "customization_method": "auto-detect",
    "manual_review_recommended": true,
    "tunable_parameters": [
      "confidence_weights",
      "thresholds.auto_execute",
      "detection_patterns.redundancy_threshold",
      "detection_patterns.staleness_months",
      "automation.enable_*"
    ]
  },

  "testing": {
    "unit_tests": "npm test",
    "integration_tests": "npm run test:integration",
    "e2e_validation": [
      "Test generate_project_index()",
      "Test validate_workspace_documentation()",
      "Test analyze_documentation_health()",
      "Test execute_documentation_operation() with dryRun: true"
    ]
  },

  "documentation": {
    "human_readable": "README.md",
    "api_reference": "Generated from JSDoc comments",
    "configuration_guide": "workspace-index-config.json includes inline comments",
    "examples": "See README.md Usage Examples section"
  },

  "support": {
    "issues": "Check logs at ~/.claude-code/logs/mcp-server-workspace-index.log",
    "common_issues": [
      {
        "issue": "MCP not appearing in Claude Code",
        "solution": "Verify config.json syntax, restart Claude Code, check absolute paths"
      },
      {
        "issue": "Auto-detection finds wrong paths",
        "solution": "Manually edit workspace-index-config.json, replace AUTO_DETECT with correct paths"
      },
      {
        "issue": "Too many false positives in supersession detection",
        "solution": "Increase auto_execute threshold to 0.90 or 0.95, add files to critical_docs list"
      }
    ]
  },

  "metadata": {
    "author": "Medical Practice Workspace",
    "created": "2025-11-04",
    "license": "MIT",
    "template_standard_version": "1.0",
    "follows_pattern": "dual-environment-mcp-template",
    "compatible_workspaces": [
      "medical-practice",
      "software-development",
      "documentation-heavy",
      "multi-project"
    ]
  }
}
